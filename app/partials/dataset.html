<ol class="breadcrumb">
  <li>Accueil</li>
  <li><a href="/services">Services</a></li>
  <li><a href="/services/{{ service._id }}/datasets">{{ service.name }}</a></li>
  <li class="active">{{ dataset.metadata.title }}</li>
</ol>

<div class="row">

  <div class="col-lg-8">
    <h1>{{ dataset.metadata.title }}</h1>
    <p>
      Type : <strong>{{ datasetTypes[dataset.metadata.type] }}</strong> -
      Dernière mise à jour : <em>{{ dataset.metadata._updated | timeago }}</em>
    </p>
    <div class="alert alert-warning" ng-if="moreRecent">
      <div>Une version plus récente existe sur le catalogue <strong>{{ moreRecent.parentCatalog.name }}</strong>.</div>
      <div><a href="/services/{{ moreRecent.parentCatalog._id }}/datasets/{{ moreRecent._id }}">Cliquez ici pour y accéder</a></div>
    </div>
    <p>{{ dataset.metadata.abstract }}</p>
    <hr>

    <div class="row">
      <div class="col-lg-7">
        <h3><i class="fa fa-briefcase"></i> Organisations associées</h3>
        <div class="panel panel-default" ng-repeat="contact in dataset.metadata.contacts.concat(dataset.metadata._contacts)">
          <div class="panel-heading">
            <h3 class="panel-title">{{ contactTypes[contact.role || 'pointOfContact'] }}</h3>
          </div>
          <div class="panel-body">
            <div ng-if="contact.organizationName"><strong>{{ contact.organizationName }}</strong></div>
            <div ng-if="contact.positionName">{{ contact.positionName }}</div>
            <div ng-if="contact.individualName">{{ contact.individualName }}</div>
            <div ng-if="contact.email"><i class="fa fa-envelope-o"></i> <a href="mailto:{{ contact.email }}">{{ contact.email }}</a></div>
          </div>
        </div>
      </div>
      <div class="col-lg-5">
        <h3><i class="fa fa-tags"></i> Mots-clés</h3>
        <div><span ng-repeat="keyword in dataset.metadata.keywords"><span class="label label-info">{{ keyword }}</span> </span></div>

        <h3><i class="fa fa-download"></i> Téléchargement</h3>
        <div ng-repeat="rs in dataset.relatedServices">
          <a ng-if="rs.status === 'ok' && rs.protocol === 'wfs'" target="_blank" href="/api/services/{{ service._id }}/datasets/{{ dataset.hashedId }}/resources/{{ rs._id }}/json">Télécharger {{ rs.name }} au format GeoJSON</a>
        </div>

        <h3><i class="fa fa-download"></i> Ressources</h3>
        <div ng-repeat="resource in dataset.metadata.onlineResources"><a title="{{ resource.protocol }}" href="{{ resource.link }}">{{ resource.name || resource.link }}</a></div>

        <h3><i class="fa fa-download"></i> Archives</h3>
        <div ng-repeat="record in archivedRecords">
          <a target="_blank" href="/api/catalogs/{{ service._id }}/records/{{ encodeURIComponent(dataset.identifier) }}/snapshots/{{ record._id }}/xml">Version du {{ record.timestamp | date : 'medium' }}</a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div ng-if="dataset.metadata.graphicOverviews[0]">
      <img ng-src="{{ dataset.metadata.graphicOverviews[0].fileName }}" class="img-responsive img-thumbnail">
    </div>

    <div>
      <h3>Diffusion</h3>
      <p ng-if="sameIdentifierDatasets.length === 0">Ce jeu de données n'est disponible que dans ce catalogue.</p>
      <div ng-if="sameIdentifierDatasets.length > 0">
        <p>Ce jeu de données est aussi disponible dans les catalogues suivantes :</p>
        <ul>
          <li ng-repeat="altDataset in sameIdentifierDatasets">
            <a href="/services/{{ altDataset.parentCatalog._id }}/datasets/{{ altDataset._id }}">{{ altDataset.parentCatalog.name }}</a><br>
            <span style="font-size: 85%"><em>(dernière mise à jour {{ altDataset.metadata._updated | timeago }})</em></span>
          </li>
        </ul>
      </div>
    </div>

    <div>
      <h3>Administration</h3>
      <ul>
        <li><button class="btn-link" ng-click="forceReprocess()">Mettre à jour les références</button></li>
      </ul>
    </div>
  </div>

</div>
